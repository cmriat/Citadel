# Citadel Release ç”¨æˆ·æŒ‡å—

è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’ŒæŠ€æœ¯æ–‡æ¡£ã€‚

## ç›®å½•

1. [å¿«é€Ÿå…¥é—¨](#å¿«é€Ÿå…¥é—¨)
2. [ä¸‹è½½CLIè¯¦è§£](#ä¸‹è½½cliè¯¦è§£)
3. [è½¬æ¢CLIè¯¦è§£](#è½¬æ¢cliè¯¦è§£)
4. [åˆå¹¶CLIè¯¦è§£](#åˆå¹¶cliè¯¦è§£)
5. [ä¸Šä¼ CLIè¯¦è§£](#ä¸Šä¼ cliè¯¦è§£)
6. [æ•°æ®æ ¼å¼è¯´æ˜](#æ•°æ®æ ¼å¼è¯´æ˜)
7. [æŠ€æœ¯åŸç†](#æŠ€æœ¯åŸç†)
8. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## å¿«é€Ÿå…¥é—¨

5åˆ†é’Ÿå®Œæˆç¯å¢ƒé…ç½®å’Œé¦–æ¬¡æ•°æ®å¤„ç†ã€‚

### æ­¥éª¤1ï¼šå®‰è£…ç¯å¢ƒ

```bash
# ç¡®ä¿å·²å®‰è£…pixi
curl -fsSL https://pixi.sh/install.sh | bash

# è¿›å…¥é¡¹ç›®ç›®å½•å¹¶å®‰è£…ä¾èµ–
cd /data/maozan/code/Citadel_release
pixi install
```

### æ­¥éª¤2ï¼šé…ç½®mcå·¥å…·

ç¡®ä¿mcå·¥å…·å·²é…ç½®BOSè®¿é—®ï¼š

```bash
# æ£€æŸ¥mcæ˜¯å¦å¯ç”¨
/home/maozan/mc --version

# å¦‚æœæœªé…ç½®ï¼Œæ·»åŠ BOSåˆ«å
/home/maozan/mc alias set bos <endpoint> <access-key> <secret-key>

# éªŒè¯è¿æ¥
/home/maozan/mc ls bos/
```

### æ­¥éª¤3ï¼šä¸‹è½½æ•°æ®

```bash
pixi run download \
  --bos-path "srgdata/robot/raw_data/upload_test/online_test_hdf5_v1/fold_laundry/" \
  --local-path "./test_data/download_test/"
```

### æ­¥éª¤4ï¼šè½¬æ¢æ•°æ®

```bash
pixi run convert \
  --input-dir "./test_data/download_test/" \
  --output-dir "./test_data/convert_test/"
```

### æ­¥éª¤5ï¼šåˆå¹¶æ•°æ®é›†ï¼ˆå¯é€‰ï¼‰

å¦‚æœè½¬æ¢åç”Ÿæˆäº†å¤šä¸ªç‹¬ç«‹episodeï¼Œéœ€è¦åˆå¹¶ä¸ºå•ä¸ªæ•°æ®é›†ï¼š

```bash
pixi run merge \
  --sources ./test_data/convert_test/episode_* \
  --output "./test_data/merged_dataset/" \
  --state-max-dim 14 \
  --action-max-dim 14
```

### æ­¥éª¤6ï¼šä¸Šä¼ æ•°æ®

å°†åˆå¹¶åçš„æ•°æ®é›†ä¸Šä¼ åˆ°BOSï¼š

```bash
pixi run upload \
  --local-dir "./test_data/merged_dataset/" \
  --bos-path "srgdata/robot/lerobot_data/test/"
```

å®Œæˆï¼ç°åœ¨æ•°æ®å·²ç»ä»BOSä¸‹è½½ã€è½¬æ¢ã€åˆå¹¶å¹¶ä¸Šä¼ å›BOSçš„LeRobotç›®å½•ã€‚

å®Œæˆï¼è½¬æ¢åçš„LeRobot v2.1æ ¼å¼æ•°æ®å·²ä¿å­˜åœ¨è¾“å‡ºç›®å½•ã€‚

---

## ä¸‹è½½CLIè¯¦è§£

### å‘½ä»¤æ ¼å¼

```bash
pixi run download [OPTIONS]
```

### å®Œæ•´å‚æ•°åˆ—è¡¨

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--bos-path` | string | `srgdata/robot/raw_data/.../fold_laundry/` | BOSè¿œç¨‹è·¯å¾„ |
| `--local-path` | string | `test_data/download_test/` | æœ¬åœ°ä¿å­˜ç›®å½• |
| `--concurrency` | int | `10` | å¹¶å‘ä¸‹è½½æ•°ï¼ˆæ¨è10-15ï¼‰ |
| `--mc-path` | string | `/home/maozan/mc` | mcå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ |

### ä½¿ç”¨ç¤ºä¾‹

**åŸºç¡€ç”¨æ³•ï¼š**
```bash
pixi run download
```

**è‡ªå®šä¹‰è·¯å¾„ï¼š**
```bash
pixi run download \
  --bos-path "srgdata/robot/raw_data/other_task/" \
  --local-path "/data/project/raw/"
```

**é«˜å¹¶å‘ä¸‹è½½ï¼š**
```bash
pixi run download --concurrency 15
```

### è¾“å‡ºè¯´æ˜

ä¸‹è½½è¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºï¼š
- BOSè¿æ¥çŠ¶æ€
- æ–‡ä»¶ä¸‹è½½è¿›åº¦ï¼ˆé€ä¸ªæ˜¾ç¤ºï¼‰
- å®Œæˆç»Ÿè®¡ï¼ˆæ–‡ä»¶æ•°ã€æ€»å¤§å°ã€é€Ÿåº¦ï¼‰

```
================================================================================
ğŸ“¥ BOSä¸‹è½½å·¥å…· - Citadel Release
================================================================================
BOSè·¯å¾„: bos/srgdata/...
æœ¬åœ°è·¯å¾„: /home/user/data/
å¹¶å‘æ•°: 10
================================================================================

âœ“ mcå·¥å…·å·²æ‰¾åˆ°: /home/maozan/mc

ğŸ”— æ£€æŸ¥BOSè¿æ¥...
âœ“ BOSè¿æ¥æˆåŠŸ
âœ“ æœ¬åœ°ç›®å½•å·²åˆ›å»º

ğŸš€ å¼€å§‹ä¸‹è½½...

[ 1] âœ“ episode_0001.h5
[ 2] âœ“ episode_0002.h5
...

================================================================================
ğŸ“Š ä¸‹è½½å®Œæˆç»Ÿè®¡
================================================================================
ä¸‹è½½æ–‡ä»¶æ•°: 18
æ€»å¤§å°: 246.00 MB
æ€»è€—æ—¶: 16.0ç§’
å¹³å‡é€Ÿåº¦: 15.22 MB/s
================================================================================
```

---

## è½¬æ¢CLIè¯¦è§£

### å‘½ä»¤æ ¼å¼

```bash
pixi run convert [OPTIONS]
```

### å®Œæ•´å‚æ•°åˆ—è¡¨

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--input-dir` | string | `test_data/download_test/` | è¾“å…¥HDF5ç›®å½• |
| `--output-dir` | string | `test_data/convert_test/` | è¾“å‡ºLeRobotç›®å½• |
| `--robot-type` | string | `airbot_play` | æœºå™¨äººç±»å‹æ ‡è¯† |
| `--fps` | int | `25` | è¾“å‡ºè§†é¢‘å¸§ç‡ |
| `--task` | string | `Fold the laundry` | ä»»åŠ¡æè¿° |
| `--parallel-jobs` | int | `4` | å¹¶å‘è½¬æ¢æ•° |
| `--file-pattern` | string | `episode_*.h5` | æ–‡ä»¶åŒ¹é…æ¨¡å¼ |

### ä½¿ç”¨ç¤ºä¾‹

**åŸºç¡€ç”¨æ³•ï¼š**
```bash
pixi run convert
```

**æŒ‡å®šæœºå™¨äººç±»å‹å’Œä»»åŠ¡ï¼š**
```bash
pixi run convert \
  --robot-type "custom_robot" \
  --task "Pick and place objects"
```

**é«˜å¹¶å‘è½¬æ¢ï¼š**
```bash
pixi run convert --parallel-jobs 8
```

**è½¬æ¢ç‰¹å®šæ–‡ä»¶ï¼š**
```bash
pixi run convert --file-pattern "episode_000[1-5].h5"
```

### è¾“å‡ºè¯´æ˜

```
================================================================================
ğŸ”„ HDF5æ‰¹é‡è½¬æ¢å·¥å…· - Citadel Release
================================================================================
è¾“å…¥ç›®å½•: /home/user/data/raw/
è¾“å‡ºç›®å½•: /home/user/data/lerobot/
æœºå™¨äººç±»å‹: airbot_play
FPS: 25
ä»»åŠ¡: Fold the laundry
å¹¶å‘æ•°: 4
================================================================================

ğŸ“¦ æ‰¾åˆ° 18 ä¸ªHDF5æ–‡ä»¶:
  - episode_0001.h5
  - episode_0002.h5
  ...

ğŸš€ å¼€å§‹æ‰¹é‡è½¬æ¢ï¼ˆ4ä¸ªå¹¶å‘ä»»åŠ¡ï¼‰...

[ 1/18] âœ“ episode_0001.h5           (1.2s)
[ 2/18] âœ“ episode_0002.h5           (0.9s)
...

================================================================================
ğŸ“Š è½¬æ¢å®Œæˆç»Ÿè®¡
================================================================================
æ€»æ–‡ä»¶æ•°: 18
âœ“ æˆåŠŸ: 18
â±ï¸  æ€»è€—æ—¶: 17.0ç§’ (å¹³å‡ 1.0ç§’/æ–‡ä»¶)
================================================================================
âœ… æ‰€æœ‰æ–‡ä»¶è½¬æ¢æˆåŠŸï¼
================================================================================
```

---

## åˆå¹¶CLIè¯¦è§£

### å‘½ä»¤æ ¼å¼

```bash
pixi run merge [OPTIONS]
```

### å®Œæ•´å‚æ•°åˆ—è¡¨

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--sources` | list[str] | å¿…å¡« | æºæ•°æ®é›†è·¯å¾„åˆ—è¡¨ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰ |
| `--output` | string | å¿…å¡« | è¾“å‡ºåˆå¹¶æ•°æ®é›†è·¯å¾„ |
| `--state-max-dim` | int | `32` | çŠ¶æ€å‘é‡æœ€å¤§ç»´åº¦ |
| `--action-max-dim` | int | `32` | åŠ¨ä½œå‘é‡æœ€å¤§ç»´åº¦ |
| `--fps` | int | `25` | è§†é¢‘å¸§ç‡ |
| `--copy-images` | bool | `False` | æ˜¯å¦å¤åˆ¶å›¾åƒæ–‡ä»¶ |

### ä½¿ç”¨ç¤ºä¾‹

**åŸºç¡€ç”¨æ³•ï¼ˆåˆå¹¶2ä¸ªæ•°æ®é›†ï¼‰ï¼š**
```bash
pixi run merge \
  --sources "./converted/episode_0001/" "./converted/episode_0002/" \
  --output "./merged_dataset/"
```

**ä½¿ç”¨é€šé…ç¬¦åˆå¹¶æ‰€æœ‰episodeï¼š**
```bash
pixi run merge \
  --sources ./converted/episode_* \
  --output "./merged_dataset/" \
  --state-max-dim 14 \
  --action-max-dim 14
```

**æŒ‡å®šå¸§ç‡å’Œå¤åˆ¶å›¾åƒï¼š**
```bash
pixi run merge \
  --sources ./data/episode_* \
  --output "./output/" \
  --fps 30 \
  --copy-images
```

### åŠŸèƒ½ç‰¹æ€§

**è‡ªåŠ¨ç»´åº¦å¯¹é½**ï¼š
- è‡ªåŠ¨æ£€æµ‹æ‰€æœ‰æºæ•°æ®é›†çš„state/actionç»´åº¦
- ä½¿ç”¨é›¶å¡«å……ç»Ÿä¸€åˆ°æŒ‡å®šçš„æœ€å¤§ç»´åº¦
- ç¡®ä¿åˆå¹¶åæ•°æ®é›†ç»´åº¦ä¸€è‡´

**ç´¢å¼•é‡æ’**ï¼š
- è‡ªåŠ¨é‡æ–°ç¼–å·episodeç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰
- è‡ªåŠ¨é‡æ–°ç¼–å·frameç´¢å¼•ï¼ˆæ¯ä¸ªepisodeä»0å¼€å§‹ï¼‰
- ä¿æŒå…¨å±€ç´¢å¼•çš„è¿ç»­æ€§

**å…ƒæ•°æ®åˆå¹¶**ï¼š
- åˆå¹¶æ‰€æœ‰æ•°æ®é›†çš„meta/info.json
- åˆå¹¶ä»»åŠ¡åˆ—è¡¨ï¼ˆå»é‡ï¼‰
- è®¡ç®—æ€»å¸§æ•°ã€æ€»è§†é¢‘æ•°ã€æ€»episodesç­‰ç»Ÿè®¡ä¿¡æ¯

**è§†é¢‘æ–‡ä»¶å¤„ç†**ï¼š
- è‡ªåŠ¨å¤åˆ¶æ‰€æœ‰ç›¸æœºè§†é¢‘æ–‡ä»¶
- é‡æ–°å‘½åä»¥åŒ¹é…æ–°çš„episodeç´¢å¼•
- ä¿æŒåŸå§‹è§†é¢‘è´¨é‡

### è¾“å‡ºè¯´æ˜

```
================================================================================
ğŸ”€ LeRobotæ•°æ®é›†åˆå¹¶å·¥å…· - Citadel Release
================================================================================
æºæ•°æ®é›†æ•°é‡: 232
  1. ./converted/episode_0001/
  2. ./converted/episode_0002/
  ...
è¾“å‡ºè·¯å¾„: ./merged_dataset/
çŠ¶æ€å‘é‡æœ€å¤§ç»´åº¦: 14
åŠ¨ä½œå‘é‡æœ€å¤§ç»´åº¦: 14
è§†é¢‘å¸§ç‡: 25
å¤åˆ¶å›¾åƒ: å¦
================================================================================

ğŸ“ éªŒè¯æºæ•°æ®é›†...
  âœ“ ./converted/episode_0001/
  âœ“ ./converted/episode_0002/
  ...

ğŸš€ å¼€å§‹åˆå¹¶æ•°æ®é›†...

æ­£åœ¨åˆå¹¶ episode 1/232...
æ­£åœ¨åˆå¹¶ episode 2/232...
...

================================================================================
âœ… æ•°æ®é›†åˆå¹¶å®Œæˆï¼
================================================================================
è¾“å‡ºä½ç½®: ./merged_dataset/

ğŸ“Š åˆå¹¶åç»Ÿè®¡:
  æ€» Episodes: 232
  æ€»å¸§æ•°: 365518
  æ€»ä»»åŠ¡æ•°: 1
  æ€»è§†é¢‘æ•°: 696
================================================================================
```

### ä½¿ç”¨åœºæ™¯

**åœºæ™¯1ï¼šæ‰¹é‡è½¬æ¢ååˆå¹¶**
```bash
# æ­¥éª¤1: æ‰¹é‡è½¬æ¢HDF5æ–‡ä»¶ï¼ˆç”Ÿæˆå¤šä¸ªç‹¬ç«‹episodeï¼‰
pixi run convert --input-dir "./raw_hdf5/" --output-dir "./converted/"

# æ­¥éª¤2: åˆå¹¶æ‰€æœ‰episodeä¸ºå•ä¸ªæ•°æ®é›†
pixi run merge --sources ./converted/episode_* --output "./final_dataset/"
```

**åœºæ™¯2ï¼šåˆå¹¶ä¸åŒæ‰¹æ¬¡çš„æ•°æ®**
```bash
# åˆå¹¶æ¥è‡ªä¸åŒæ—¶é—´æˆ–ä¸åŒä»»åŠ¡çš„æ•°æ®
pixi run merge \
  --sources "./batch1/episode_*" "./batch2/episode_*" "./batch3/episode_*" \
  --output "./combined_all/"
```

**åœºæ™¯3ï¼šå¤„ç†ä¸åŒç»´åº¦çš„æ•°æ®**
```bash
# è‡ªåŠ¨å¯¹é½ä¸åŒç»´åº¦çš„state/actionå‘é‡
pixi run merge \
  --sources "./robot_a/" "./robot_b/" \
  --output "./mixed_robots/" \
  --state-max-dim 20 \
  --action-max-dim 20
```

### æ³¨æ„äº‹é¡¹

1. **æºæ•°æ®é›†éªŒè¯**ï¼šæ‰€æœ‰æºè·¯å¾„å¿…é¡»æ˜¯æœ‰æ•ˆçš„LeRobot v2.1æ ¼å¼æ•°æ®é›†
2. **è¾“å‡ºè·¯å¾„è¦†ç›–**ï¼šå¦‚æœè¾“å‡ºè·¯å¾„å·²å­˜åœ¨ï¼Œä¼šæç¤ºæ˜¯å¦è¦†ç›–
3. **ç»´åº¦è®¾ç½®**ï¼šç¡®ä¿max-dimå‚æ•°å¤§äºç­‰äºå®é™…æ•°æ®çš„æœ€å¤§ç»´åº¦
4. **ç£ç›˜ç©ºé—´**ï¼šåˆå¹¶æ“ä½œä¼šå¤åˆ¶è§†é¢‘æ–‡ä»¶ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿç£ç›˜ç©ºé—´
5. **å†…å­˜ä½¿ç”¨**ï¼šå¤§é‡æ•°æ®åˆå¹¶æ—¶æ³¨æ„å†…å­˜å ç”¨

---

## ä¸Šä¼ CLIè¯¦è§£

### å‘½ä»¤æ ¼å¼

```bash
pixi run upload [OPTIONS]
```

### å®Œæ•´å‚æ•°åˆ—è¡¨

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--local-dir` | string | `./data/lerobot/` | æœ¬åœ°LeRobotæ•°æ®é›†ç›®å½• |
| `--bos-path` | string | `srgdata/robot/lerobot_data/` | BOSç›®æ ‡è·¯å¾„ï¼ˆä¸å«bos/å‰ç¼€ï¼‰ |
| `--concurrency` | int | `10` | å¹¶å‘ä¸Šä¼ æ•°ï¼ˆæ¨è10-15ï¼‰ |
| `--mc-path` | string | `/home/maozan/mc` | mcå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ |

### ä½¿ç”¨ç¤ºä¾‹

**åŸºç¡€ç”¨æ³•ï¼š**
```bash
pixi run upload
```

**æŒ‡å®šæœ¬åœ°ç›®å½•å’ŒBOSè·¯å¾„ï¼š**
```bash
pixi run upload \
  --local-dir "./merged_dataset/" \
  --bos-path "srgdata/robot/lerobot_data/fold_laundry/"
```

**é«˜å¹¶å‘ä¸Šä¼ ï¼š**
```bash
pixi run upload \
  --local-dir "./data/" \
  --bos-path "srgdata/robot/lerobot_data/test/" \
  --concurrency 15
```

**è‡ªå®šä¹‰mcè·¯å¾„ï¼š**
```bash
pixi run upload \
  --local-dir "./output/" \
  --bos-path "srgdata/robot/datasets/" \
  --mc-path "/usr/local/bin/mc"
```

### è¾“å‡ºè¯´æ˜

```
================================================================================
ğŸ“¤ BOSä¸Šä¼ å·¥å…· - Citadel Release
================================================================================
æœ¬åœ°è·¯å¾„: /home/user/data/merged_dataset/
BOSè·¯å¾„: bos/srgdata/robot/lerobot_data/fold_laundry/
å¹¶å‘æ•°: 10
================================================================================

âœ“ mcå·¥å…·å·²æ‰¾åˆ°: /home/maozan/mc

ğŸ”— æ£€æŸ¥BOSè¿æ¥...
âœ“ BOSè¿æ¥æˆåŠŸ

ğŸ“ æ‰«ææœ¬åœ°ç›®å½•...
æ‰¾åˆ°ä»¥ä¸‹ç›®å½•ç»“æ„:
  - meta/ (2ä¸ªæ–‡ä»¶)
  - data/chunk-000/ (232ä¸ªæ–‡ä»¶)
  - videos/chunk-000/ (696ä¸ªè§†é¢‘æ–‡ä»¶)

ğŸš€ å¼€å§‹ä¸Šä¼ ...

ä¸Šä¼ è¿›åº¦: 100% (1856/1856 æ–‡ä»¶)

================================================================================
ğŸ“Š ä¸Šä¼ å®Œæˆç»Ÿè®¡
================================================================================
ä¸Šä¼ æ–‡ä»¶æ•°: 1856
æ€»å¤§å°: 640.00 MB
æ€»è€—æ—¶: 10.2ç§’
å¹³å‡é€Ÿåº¦: 182 files/s (62.75 MB/s)
================================================================================
```

### ç›®å½•ç»“æ„éªŒè¯

ä¸Šä¼ å‰ä¼šè‡ªåŠ¨éªŒè¯æœ¬åœ°ç›®å½•æ˜¯å¦ä¸ºæœ‰æ•ˆçš„LeRobot v2.1æ•°æ®é›†ï¼š

**å¿…éœ€çš„æ–‡ä»¶ç»“æ„ï¼š**
```
dataset_directory/
â”œâ”€â”€ meta/
â”‚   â”œâ”€â”€ info.json          # å¿…éœ€
â”‚   â””â”€â”€ tasks.json         # å¿…éœ€
â”œâ”€â”€ data/
â”‚   â””â”€â”€ chunk-000/
â”‚       â””â”€â”€ episode_*.parquet
â””â”€â”€ videos/
    â””â”€â”€ chunk-000/
        â””â”€â”€ episode_*/
            â””â”€â”€ *.mp4
```

**éªŒè¯æ£€æŸ¥é¡¹ï¼š**
- âœ“ `meta/info.json` æ–‡ä»¶å­˜åœ¨
- âœ“ `meta/tasks.json` æ–‡ä»¶å­˜åœ¨
- âœ“ `data/chunk-000/` ç›®å½•å­˜åœ¨
- âœ“ è‡³å°‘åŒ…å«ä¸€ä¸ª `.parquet` æ–‡ä»¶

### æ³¨æ„äº‹é¡¹

1. **BOSè·¯å¾„æ ¼å¼**ï¼šä¸è¦åŒ…å« `bos/` å‰ç¼€ï¼Œå·¥å…·ä¼šè‡ªåŠ¨æ·»åŠ 
2. **æ•°æ®å®Œæ•´æ€§**ï¼šç¡®ä¿ä¸Šä¼ å‰æ•°æ®é›†ç»“æ„å®Œæ•´
3. **ç½‘ç»œç¨³å®šæ€§**ï¼šå¤§æ–‡ä»¶ä¸Šä¼ å»ºè®®åœ¨ç¨³å®šç½‘ç»œç¯å¢ƒä¸‹è¿›è¡Œ
4. **å¹¶å‘æ§åˆ¶**ï¼šæ ¹æ®ç½‘ç»œå¸¦å®½è°ƒæ•´å¹¶å‘æ•°ï¼Œé¿å…è¶…æ—¶
5. **è¦†ç›–è­¦å‘Š**ï¼šå¦‚æœBOSè·¯å¾„å·²å­˜åœ¨æ–‡ä»¶ï¼Œmc mirrorä¼šè‡ªåŠ¨è¦†ç›–

---

## æ•°æ®æ ¼å¼è¯´æ˜

### è¾“å…¥HDF5ç»“æ„

æœ¬å·¥å…·æ”¯æŒçš„HDF5æ–‡ä»¶æ ¼å¼ï¼š

```
episode_XXXX.h5
â”‚
â”œâ”€â”€ images/                          # å›¾åƒæ•°æ®
â”‚   â”œâ”€â”€ cam_env/
â”‚   â”‚   â”œâ”€â”€ frames_jpeg              # ç¯å¢ƒç›¸æœºå¸§ (JPEGå‹ç¼©)
â”‚   â”‚   â”œâ”€â”€ timestamp_sec            # ç§’çº§æ—¶é—´æˆ³
â”‚   â”‚   â””â”€â”€ timestamp_nanosec        # çº³ç§’çº§æ—¶é—´æˆ³
â”‚   â”œâ”€â”€ cam_left/
â”‚   â”‚   â”œâ”€â”€ frames_jpeg              # å·¦æ‰‹ç›¸æœºå¸§
â”‚   â”‚   â”œâ”€â”€ timestamp_sec
â”‚   â”‚   â””â”€â”€ timestamp_nanosec
â”‚   â””â”€â”€ cam_right/
â”‚       â”œâ”€â”€ frames_jpeg              # å³æ‰‹ç›¸æœºå¸§
â”‚       â”œâ”€â”€ timestamp_sec
â”‚       â””â”€â”€ timestamp_nanosec
â”‚
â”œâ”€â”€ joints/                          # å…³èŠ‚æ•°æ® (250Hz)
â”‚   â”œâ”€â”€ left_master/                 # å·¦è‡‚ä¸»æ§
â”‚   â”‚   â”œâ”€â”€ joint1_pos ~ joint6_pos  # 6ä¸ªå…³èŠ‚ä½ç½®
â”‚   â”‚   â”œâ”€â”€ eef_gripper_joint_pos    # æœ«ç«¯å¤¹çˆª
â”‚   â”‚   â”œâ”€â”€ timestamp_sec
â”‚   â”‚   â””â”€â”€ timestamp_nanosec
â”‚   â”œâ”€â”€ right_master/                # å³è‡‚ä¸»æ§
â”‚   â”‚   â””â”€â”€ (åŒä¸Š)
â”‚   â”œâ”€â”€ left_slave/                  # å·¦è‡‚ä»æ§
â”‚   â”‚   â””â”€â”€ (åŒä¸Š)
â”‚   â””â”€â”€ right_slave/                 # å³è‡‚ä»æ§
â”‚       â””â”€â”€ (åŒä¸Š)
â”‚
â””â”€â”€ metadata                         # å…ƒæ•°æ®
```

**æ•°æ®ç‰¹ç‚¹ï¼š**

| æ•°æ®ç±»å‹ | é‡‡æ ·ç‡ | è¯´æ˜ |
|----------|--------|------|
| å›¾åƒ | ~26 fps | JPEGå‹ç¼©ï¼Œä¸‰ä¸ªç›¸æœºå¸§æ•°å¯èƒ½ä¸ä¸€è‡´ |
| å…³èŠ‚ | 250 Hz | é«˜é¢‘é‡‡æ ·ï¼Œéœ€è¦ä¸‹é‡‡æ ·å¯¹é½åˆ°å›¾åƒå¸§ç‡ |

### è¾“å‡ºLeRobot v2.1ç»“æ„

```
episode_XXXX/
â”‚
â”œâ”€â”€ meta/
â”‚   â”œâ”€â”€ info.json                    # æ•°æ®é›†å…ƒä¿¡æ¯
â”‚   â”‚   â”œâ”€â”€ codebase_version: "v2.1"
â”‚   â”‚   â”œâ”€â”€ robot_type
â”‚   â”‚   â”œâ”€â”€ fps
â”‚   â”‚   â”œâ”€â”€ features (state/actionç»´åº¦ç­‰)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ tasks.json                   # ä»»åŠ¡æè¿°
â”‚
â”œâ”€â”€ data/
â”‚   â””â”€â”€ chunk-000/
â”‚       â””â”€â”€ episode_000000.parquet   # çŠ¶æ€/åŠ¨ä½œæ•°æ®
â”‚           â”œâ”€â”€ timestamp
â”‚           â”œâ”€â”€ frame_index
â”‚           â”œâ”€â”€ task_index
â”‚           â”œâ”€â”€ state [14ç»´]
â”‚           â””â”€â”€ action [14ç»´]
â”‚
â””â”€â”€ videos/
    â””â”€â”€ chunk-000/
        â””â”€â”€ episode_000000/
            â”œâ”€â”€ cam_env.mp4          # ç¯å¢ƒç›¸æœºè§†é¢‘
            â”œâ”€â”€ cam_left.mp4         # å·¦æ‰‹ç›¸æœºè§†é¢‘
            â””â”€â”€ cam_right.mp4        # å³æ‰‹ç›¸æœºè§†é¢‘
```

**State/Actionç»“æ„ï¼ˆ14ç»´ï¼‰ï¼š**

| ç´¢å¼• | å†…å®¹ | è¯´æ˜ |
|------|------|------|
| 0-5 | left_joint1_pos ~ left_joint6_pos | å·¦è‡‚6å…³èŠ‚ |
| 6 | left_gripper_pos | å·¦å¤¹çˆª |
| 7-12 | right_joint1_pos ~ right_joint6_pos | å³è‡‚6å…³èŠ‚ |
| 13 | right_gripper_pos | å³å¤¹çˆª |

- **State**: ä» slave æ•°æ®è¯»å–ï¼ˆæœºå™¨äººå®é™…çŠ¶æ€ï¼‰
- **Action**: ä» master æ•°æ®è¯»å–ï¼ˆäººç±»ç¤ºæ•™åŠ¨ä½œï¼‰

---

## æŠ€æœ¯åŸç†

### å¤šç›¸æœºæ—¶é—´å¯¹é½

ä¸‰ä¸ªç›¸æœºï¼ˆcam_env, cam_left, cam_rightï¼‰çš„å¸§æ•°å¯èƒ½ä¸ä¸€è‡´ã€‚è½¬æ¢è¿‡ç¨‹ï¼š

1. **ç¡®å®šåŸºå‡†å¸§æ•°**ï¼šå–ä¸‰ä¸ªç›¸æœºä¸­æœ€å°‘çš„å¸§æ•°
2. **æˆªæ–­å¤šä½™å¸§**ï¼šå…¶ä»–ç›¸æœºå¯¹é½åˆ°åŸºå‡†å¸§æ•°
3. **ä¿æŒæ—¶é—´åŒæ­¥**ï¼šä½¿ç”¨å„ç›¸æœºè‡ªå·±çš„æ—¶é—´æˆ³

### å…³èŠ‚æ•°æ®å¯¹é½

å…³èŠ‚æ•°æ®é‡‡æ ·ç‡(250Hz)è¿œé«˜äºå›¾åƒå¸§ç‡(~26fps)ã€‚å¯¹é½è¿‡ç¨‹ï¼š

1. **è¯»å–åŸºå‡†æ—¶é—´æˆ³**ï¼šä½¿ç”¨å›¾åƒå¸§çš„æ—¶é—´æˆ³ä½œä¸ºåŸºå‡†
2. **æœ€è¿‘é‚»æ’å€¼**ï¼šå¯¹æ¯ä¸ªå›¾åƒå¸§æ—¶é—´æˆ³ï¼Œæ‰¾åˆ°æœ€è¿‘çš„å…³èŠ‚æ•°æ®
3. **åˆ†åˆ«å¤„ç†**ï¼šleft_slaveå’Œright_slaveä½¿ç”¨å„è‡ªçš„æ—¶é—´æˆ³å¯¹é½

**å¯¹é½ç²¾åº¦**ï¼š
- å¹³å‡å¯¹é½è¯¯å·®ï¼š1-9ms
- æœ€å¤§å¯¹é½è¯¯å·®ï¼š<30ms

### JPEGå›¾åƒè§£ç 

è¾“å…¥HDF5ä¸­çš„å›¾åƒä»¥JPEGæ ¼å¼å‹ç¼©å­˜å‚¨ã€‚è½¬æ¢è¿‡ç¨‹ï¼š

```python
# è¯»å–JPEGå­—èŠ‚
jpeg_bytes = f["images/cam_env/frames_jpeg"][frame_idx]

# è§£ç ä¸ºPILå›¾åƒ
image = Image.open(io.BytesIO(jpeg_bytes))

# è½¬æ¢ä¸ºnumpyæ•°ç»„
rgb_array = np.array(image)
```

---

## æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯

#### 1. "mcå‘½ä»¤æœªæ‰¾åˆ°"

```
âŒ é”™è¯¯: mcå‘½ä»¤æœªæ‰¾åˆ°: /home/maozan/mc
```

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®è®¤mcå·²å®‰è£…
- ä½¿ç”¨ `--mc-path` æŒ‡å®šæ­£ç¡®è·¯å¾„
- æˆ–å®‰è£…mc: `wget https://dl.min.io/client/mc/release/linux-amd64/mc`

#### 2. "BOSè¿æ¥å¤±è´¥"

```
âŒ BOSè¿æ¥å¤±è´¥: è¿æ¥è¶…æ—¶
```

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- éªŒè¯mcåˆ«åé…ç½®: `mc alias list`
- é‡æ–°é…ç½®: `mc alias set bos <endpoint> <access-key> <secret-key>`

#### 3. "IndexError: index out of bounds"

```
IndexError: index 7492 is out of bounds for axis 0 with size 7492
```

**åŸå› **ï¼šå·¦å³è‡‚å…³èŠ‚æ•°æ®ç‚¹æ•°ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**ï¼šå·²åœ¨æœ€æ–°ç‰ˆæœ¬ä¿®å¤ã€‚ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„convert.pyè„šæœ¬ã€‚

#### 4. "è½¬æ¢è¶…æ—¶"

```
è½¬æ¢è¶…æ—¶ï¼ˆ>5åˆ†é’Ÿï¼‰
```

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥HDF5æ–‡ä»¶æ˜¯å¦æŸå
- å‡å°‘å¹¶å‘æ•°: `--parallel-jobs 2`
- æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨

#### 5. "HDF5æ–‡ä»¶æ ¼å¼ä¸åŒ¹é…"

```
KeyError: 'images/cam_env/frames_jpeg'
```

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®è®¤HDF5æ–‡ä»¶ç»“æ„ç¬¦åˆé¢„æœŸæ ¼å¼
- ä½¿ç”¨h5dumpæ£€æŸ¥æ–‡ä»¶ç»“æ„: `h5dump -H file.h5`

### è°ƒè¯•æŠ€å·§

#### æŸ¥çœ‹HDF5æ–‡ä»¶ç»“æ„

```bash
# ä½¿ç”¨h5dumpæŸ¥çœ‹ç»“æ„
h5dump -H episode_0001.h5

# ä½¿ç”¨Pythonäº¤äº’å¼æŸ¥çœ‹
python -c "
import h5py
with h5py.File('episode_0001.h5', 'r') as f:
    def print_structure(name, obj):
        print(name)
    f.visititems(print_structure)
"
```

#### å•ç‹¬è½¬æ¢å•ä¸ªæ–‡ä»¶

```bash
python scripts/convert.py \
  --hdf5-path "test_data/download_test/episode_0001.h5" \
  --output-dir "test_data/debug_test/episode_0001/" \
  --robot-type "airbot_play" \
  --fps 25 \
  --task "Debug test"
```

#### æ£€æŸ¥è½¬æ¢ç»“æœ

```bash
# æŸ¥çœ‹è¾“å‡ºç›®å½•ç»“æ„
ls -la test_data/convert_test/episode_0001/

# æ£€æŸ¥parquetæ–‡ä»¶
python -c "
import pandas as pd
df = pd.read_parquet('test_data/convert_test/episode_0001/data/chunk-000/episode_000000.parquet')
print(df.head())
print(f'Columns: {df.columns.tolist()}')
print(f'Shape: {df.shape}')
"

# æ£€æŸ¥è§†é¢‘æ–‡ä»¶
ffprobe test_data/convert_test/episode_0001/videos/chunk-000/episode_000000/cam_env.mp4
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ä¸‹è½½ä¼˜åŒ–

- **å¹¶å‘æ•°**ï¼šç½‘ç»œè‰¯å¥½æ—¶ä½¿ç”¨ `--concurrency 15`
- **åˆ†æ‰¹ä¸‹è½½**ï¼šå¤§é‡æ–‡ä»¶æ—¶åˆ†æ‰¹å¤„ç†ï¼Œé¿å…ä¸­æ–­åé‡æ–°å¼€å§‹

### è½¬æ¢ä¼˜åŒ–

- **å¹¶å‘æ•°**ï¼šæ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´ï¼Œæ¨è `--parallel-jobs $(nproc)`
- **SSDå­˜å‚¨**ï¼šè¾“å…¥è¾“å‡ºç›®å½•ä½¿ç”¨SSDå¯æ˜¾è‘—æå‡é€Ÿåº¦
- **å†…å­˜ç›‘æ§**ï¼šé«˜å¹¶å‘è½¬æ¢æ—¶æ³¨æ„å†…å­˜ä½¿ç”¨

### å…¸å‹æ€§èƒ½

| ç¯å¢ƒ | ä¸‹è½½é€Ÿåº¦ | è½¬æ¢é€Ÿåº¦ |
|------|----------|----------|
| å†…ç½‘+SSD | 15+ MB/s | 1ç§’/æ–‡ä»¶ |
| å¤–ç½‘+HDD | 5-10 MB/s | 2-3ç§’/æ–‡ä»¶ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v0.1.0
**æœ€åæ›´æ–°**: 2025-12-28
