[workspace]
name = "lerobot_converter"
version = "0.1.0"
description = "Convert airbot_play data to LeRobot v2.1 format with configurable alignment strategies"
channels = ["conda-forge"]
platforms = ["linux-64"]

[dependencies]
python = ">=3.10"
numpy = ">=1.24.0"
pandas = ">=2.0.0"
pyarrow = ">=14.0.0"
opencv = ">=4.8.0"
pillow = ">=10.0.0"
pyyaml = ">=6.0"
tqdm = ">=4.65.0"
redis-server = "*"
fastapi = ">=0.125.0,<0.126"
uvicorn = ">=0.38.0,<0.39"
python-multipart = ">=0.0.21,<0.0.22"

[pypi-dependencies]
redis = ">=5.0.0"
boto3 = ">=1.34.0"
click = ">=8.1.0"
psutil = ">=5.9.0"

[feature.dev.dependencies]
pytest = ">=7.4.0"
jupyterlab = ">=4.0.0"
ipykernel = ">=6.25.0"
ruff = ">=0.1.0"

# 定义 environments
[environments]
dev = ["dev"]

[tasks]
# =============================================================================
# 统一CLI入口（推荐使用）
# =============================================================================
# 启动 Redis 服务
start-redis = "redis-server --port 6379 --appendonly yes"

# 检查 Redis 服务状态
check-redis = "redis-cli ping"

# 本地数据转换 - 三种对齐策略
convert-nearest = "python -m lerobot_converter.cli convert --config config/strategies/nearest.yaml"
convert-chunking = "python -m lerobot_converter.cli convert --config config/strategies/chunking.yaml"
convert-window = "python -m lerobot_converter.cli convert --config config/strategies/window.yaml"

# Redis Worker - 处理队列中的转换任务
# 注意: 需要在环境中设置 BOS_ACCESS_KEY 和 BOS_SECRET_KEY
worker = "python -m lerobot_converter.cli worker --config config/storage.yaml"

# BOS Scanner - 扫描BOS上的新episodes并发布任务
scanner = "python -m lerobot_converter.cli scanner --config config/storage.yaml"

# 发布任务到Redis队列
publish = "python -m lerobot_converter.cli publish --config config/storage.yaml"

# 监控Redis队列状态
monitor = "python -m lerobot_converter.cli monitor --config config/storage.yaml"

# =============================================================================
# 测试和开发工具
# =============================================================================
test = "pytest tests/ -v"
test-aligners = "pytest tests/test_aligners.py -v"

lint = "ruff check lerobot_converter/"
format = "ruff format lerobot_converter/"
jupyter = "jupyter lab"

verify = "python examples/verify_output.py"

# =============================================================================
# 旧版脚本（已废弃，将在下一版本移除）
# =============================================================================
# 以下命令仅用于向后兼容，建议使用上面的CLI命令
legacy-convert = "python scripts/convert.py"
legacy-worker = "python scripts/redis_worker.py"
legacy-scanner = "python scripts/bos_scanner.py"
