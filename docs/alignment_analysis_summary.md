# Frame-State å¯¹é½åˆ†ææ±‡æ€»æŠ¥å‘Š

> åˆ†ææ—¶é—´ï¼š2026-02-02 (æ›´æ–°)
>
> åˆ†æå·¥å…·ï¼š`scripts/analyze_frame_state_alignment.py`
>
> åˆ†ææ–¹æ³•ï¼šState å¼•å¯¼å»å™ª + æ£€æµ‹æ¨¡å¼ä¼˜åŒ–

---

## æ±‡æ€»ç»“æœ

| æ•°æ®é›† | æ ¼å¼ | FPS | æ£€æµ‹æ¨¡å¼ | å¹³å‡åç§» | ä¸­ä½æ•°åç§» | å»¶è¿Ÿ(ms) | å»å™ªæå‡ | è¯„ä¼° |
|--------|------|-----|----------|----------|------------|----------|----------|------|
| **0115_qz2_plant/merged** | v2.0 | 25 | ROI | +0.41å¸§ | 0å¸§ | 16ms | +15.7% | âœ… ä¼˜ç§€ |
| **1226_qz2/merged** | v2.0 | 25 | ROI | +1.23å¸§ | +1å¸§ | 49ms | +33.2% | âš ï¸ æ­£å¸¸ |
| **1226_qz2/merged_nearest** | v2.0 | 25 | ROI | +1.93å¸§ | +2å¸§ | 77ms | +35.1% | âš ï¸ éœ€å…³æ³¨ |
| **aloha_mobile_cabinet** | v3.0 | 50 | Black | +1.55å¸§ | +3å¸§ | 31ms | +34.1% | âš ï¸ æ­£å¸¸ |
| **franka/move_objects** | v2.1 | 30 | ROI | **-0.76å¸§** | -1å¸§ | -25ms | +82.1% | âœ… ä¼˜ç§€ |
| **agilex_sim/left*** | v2.1 | 20 | ROI | **-1.40å¸§** | -1.5å¸§ | -70ms | +93.8% | âš ï¸ éœ€å…³æ³¨ |
| **agilex_sim/right*** | v2.1 | 20 | ROI | **-0.50å¸§** | -0.5å¸§ | -25ms | +1008% | âœ… ä¼˜ç§€ |

> \* **æ³¨æ„**: agilex_sim ä¸º**å•è‡‚äº¤æ›¿æ“ä½œ**æ•°æ®é›†ï¼Œleft/right åˆ†åˆ«å¯¹åº”ä¸åŒ episodes çš„åˆ†æç»“æœ

---

## è¯¦ç»†åˆ†æ

### 1. 0115_qz2_plant/merged

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æ•°æ®é›†è·¯å¾„ | `/pfs/.../0115_qz2_plant/merged` |
| æ ¼å¼ç‰ˆæœ¬ | LeRobot v2.0 |
| é‡‡æ ·ç‡ | 25 FPS |
| åˆ†æå¸§æ•° | 1206 |
| æ£€æµ‹äº‹ä»¶æ•° | 32 |
| **å¹³å‡åç§»** | **+0.41 å¸§ (16ms)** |
| ä¸­ä½æ•°åç§» | 0 å¸§ |
| æ ‡å‡†å·® | 1.00 å¸§ |
| åç§»èŒƒå›´ | [-1, +2] å¸§ |
| å»å™ªç›¸å…³æ€§æå‡ | 0.731 â†’ 0.846 (+15.7%) |

**ç»“è®º**: âœ… **Frame å’Œ State/Action å¯¹é½è‰¯å¥½**ï¼Œå¯ç›´æ¥ç”¨äºè®­ç»ƒã€‚

---

### 2. 1226_qz2/merged

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æ•°æ®é›†è·¯å¾„ | `/pfs/.../1226_qz2/merged` |
| æ ¼å¼ç‰ˆæœ¬ | LeRobot v2.0 |
| é‡‡æ ·ç‡ | 25 FPS |
| åˆ†æå¸§æ•° | 2115 |
| æ£€æµ‹äº‹ä»¶æ•° | 57 |
| **å¹³å‡åç§»** | **+1.23 å¸§ (49ms)** |
| ä¸­ä½æ•°åç§» | +1 å¸§ |
| æ ‡å‡†å·® | 1.09 å¸§ |
| åç§»èŒƒå›´ | [-1, +4] å¸§ |
| å»å™ªç›¸å…³æ€§æå‡ | 0.657 â†’ 0.874 (+33.2%) |

**ç»“è®º**: âš ï¸ **Video è½»å¾®æ»å**ï¼Œ49ms å»¶è¿Ÿåœ¨å¯æ¥å—èŒƒå›´å†…ã€‚

---

### 3. 1226_qz2/merged_nearest

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æ•°æ®é›†è·¯å¾„ | `/pfs/.../1226_qz2/merged_nearest` |
| æ ¼å¼ç‰ˆæœ¬ | LeRobot v2.0 |
| é‡‡æ ·ç‡ | 25 FPS |
| åˆ†æå¸§æ•° | 2122 |
| æ£€æµ‹äº‹ä»¶æ•° | 56 |
| **å¹³å‡åç§»** | **+1.93 å¸§ (77ms)** |
| ä¸­ä½æ•°åç§» | +2 å¸§ |
| æ ‡å‡†å·® | 1.16 å¸§ |
| åç§»èŒƒå›´ | [0, +5] å¸§ |
| å»å™ªç›¸å…³æ€§æå‡ | 0.623 â†’ 0.841 (+35.1%) |

**ç»“è®º**: âš ï¸ **Video æ»åçº¦ 2 å¸§**ï¼Œ77ms å»¶è¿Ÿå»ºè®®åœ¨è®­ç»ƒæ—¶è€ƒè™‘è¡¥å¿ã€‚

> **å¯¹æ¯”**: `merged_nearest` æ¯” `merged` çš„å»¶è¿Ÿæ›´å¤§ (+0.7å¸§)ï¼Œè¯´æ˜ nearest æ’å€¼æ–¹å¼å¯èƒ½å¼•å…¥é¢å¤–å»¶è¿Ÿã€‚

---

### 4. aloha_mobile_cabinet

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æ•°æ®é›†è·¯å¾„ | `/pfs/.../opensource/aloha_mobile_cabinet` |
| æ ¼å¼ç‰ˆæœ¬ | LeRobot v3.0 |
| é‡‡æ ·ç‡ | 50 FPS |
| æœºå™¨äººç±»å‹ | ALOHA |
| åˆ†æå¸§æ•° | 1500 |
| æ£€æµ‹äº‹ä»¶æ•° | 161 |
| **å¹³å‡åç§»** | **+1.55 å¸§ (31ms)** |
| ä¸­ä½æ•°åç§» | +3 å¸§ |
| æ ‡å‡†å·® | 3.41 å¸§ |
| åç§»èŒƒå›´ | [-5, +5] å¸§ |
| å»å™ªç›¸å…³æ€§æå‡ | 0.460 â†’ 0.617 (+34.1%) |

**ç»“è®º**: âš ï¸ **Video è½»å¾®æ»å**ï¼Œ31ms å»¶è¿Ÿåœ¨å¯æ¥å—èŒƒå›´å†…ã€‚ä½†åç§»åˆ†å¸ƒè¾ƒåˆ†æ•£ï¼ˆæ ‡å‡†å·®è¾ƒå¤§ï¼‰ã€‚

---

### 5. task_table30_move_objects_into_box_v21 (Franka)

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æ•°æ®é›†è·¯å¾„ | `/pfs/.../rc/task_table30_move_objects_into_box_v21` |
| æ ¼å¼ç‰ˆæœ¬ | LeRobot v2.1 |
| é‡‡æ ·ç‡ | 30 FPS |
| æœºå™¨äººç±»å‹ | Franka (å•è‡‚) |
| ç›¸æœº | handeye (æ‰‹è…•ç›¸æœº) |
| åˆ†æå¸§æ•° | 1352 |
| æ£€æµ‹äº‹ä»¶æ•° | 21 |
| **å¹³å‡åç§»** | **-0.76 å¸§ (-25ms)** |
| ä¸­ä½æ•°åç§» | -1.0 å¸§ |
| æ ‡å‡†å·® | 3.12 å¸§ |
| åç§»èŒƒå›´ | [-5, +5] å¸§ |
| å»å™ªç›¸å…³æ€§æå‡ | 0.256 â†’ 0.466 (+82.1%) |

**ç»“è®º**: âœ… **Image ç•¥å¾®å¿«äº State**ï¼ˆè´Ÿåç§»ï¼‰ï¼Œ-25ms å»¶è¿Ÿåœ¨å¯æ¥å—èŒƒå›´å†…ã€‚

**ç‰¹ç‚¹**: Franka å•è‡‚æœºå™¨äººï¼Œä½¿ç”¨ `observation.images.handeye` æ‰‹è…•ç›¸æœºï¼Œå¤¹çˆª state åœ¨ç¬¬ 8 ç»´ã€‚

---

### 6. adjust_bottle/agilex_clean/train (RoboTwin ä»¿çœŸ)

> **é‡è¦ç‰¹ç‚¹**: è¿™æ˜¯ä¸€ä¸ª**å•è‡‚äº¤æ›¿æ“ä½œ**ä»»åŠ¡ï¼Œæ¯ä¸ª episode åªä½¿ç”¨å·¦è‡‚ **æˆ–** å³è‡‚ï¼Œä¸ä¼šåŒæ—¶ä½¿ç”¨åŒè‡‚ã€‚
>
> ä» 20 ä¸ª episodes çš„ç»Ÿè®¡æ¥çœ‹ï¼š
> - **å·¦è‡‚æ“ä½œ**: 15 ä¸ª episodes (0-5, 8-11, 13-14, 16-17, 19)
> - **å³è‡‚æ“ä½œ**: 5 ä¸ª episodes (6-7, 12, 15, 18)
>
> å› æ­¤åˆ†ææ—¶éœ€è¦æ ¹æ® episode é€‰æ‹©å¯¹åº”çš„ç›¸æœºå’Œå¤¹çˆªã€‚

**å·¦å¤¹çˆª (Left Gripper)**

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æ•°æ®é›†è·¯å¾„ | `/pfs/.../robotwin/adjust_bottle/agilex_clean/train` |
| æ ¼å¼ç‰ˆæœ¬ | LeRobot v2.1 |
| é‡‡æ ·ç‡ | 20 FPS |
| æœºå™¨äººç±»å‹ | Agilex ALOHA (ä»¿çœŸ) |
| ç›¸æœº | cam_left_wrist |
| åˆ†æå¸§æ•° | 105 |
| æ£€æµ‹äº‹ä»¶æ•° | 10 |
| **å¹³å‡åç§»** | **-1.40 å¸§ (-70ms)** |
| ä¸­ä½æ•°åç§» | -1.5 å¸§ |
| æ ‡å‡†å·® | 2.73 å¸§ |
| åç§»èŒƒå›´ | [-5, +3] å¸§ |
| å»å™ªç›¸å…³æ€§æå‡ | 0.351 â†’ 0.680 (+93.8%) |

**ç»“è®º**: âš ï¸ **Image æ˜æ˜¾å¿«äº State**ï¼Œ-70ms å»¶è¿Ÿå»ºè®®è®­ç»ƒæ—¶è€ƒè™‘è¡¥å¿ã€‚

**å³å¤¹çˆª (Right Gripper)**

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| ç›¸æœº | cam_right_wrist |
| åˆ†æå¸§æ•° | 109 |
| æ£€æµ‹äº‹ä»¶æ•° | 10 |
| **å¹³å‡åç§»** | **-0.50 å¸§ (-25ms)** |
| ä¸­ä½æ•°åç§» | -0.5 å¸§ |
| æ ‡å‡†å·® | 2.87 å¸§ |
| åç§»èŒƒå›´ | [-5, +4] å¸§ |
| å»å™ªç›¸å…³æ€§æå‡ | -0.053 â†’ 0.482 (+1008.6%) |

**ç»“è®º**: âœ… **Image ç•¥å¾®å¿«äº State**ï¼Œ-25ms å»¶è¿Ÿåœ¨å¯æ¥å—èŒƒå›´å†…ã€‚

**ä»»åŠ¡ç‰¹ç‚¹**: 
- å•è‡‚äº¤æ›¿æ“ä½œï¼Œæ¯ä¸ª episode åªä½¿ç”¨ä¸€åªæ‰‹è‡‚
- å·¦è‡‚æ“ä½œæ—¶ä½¿ç”¨ `cam_left_wrist` ç›¸æœº
- å³è‡‚æ“ä½œæ—¶ä½¿ç”¨ `cam_right_wrist` ç›¸æœº
- é™æ­¢æ‰‹è‡‚çš„å¤¹çˆª state ä¿æŒæ’å®šï¼ˆæ— å˜åŒ–äº‹ä»¶ï¼‰

**åˆ†æç­–ç•¥**: 
å¯¹äºå•è‡‚äº¤æ›¿æ“ä½œæ•°æ®é›†ï¼Œéœ€è¦**æŒ‰ episode åˆ†åˆ«åˆ†æ**ä¸åŒæ‰‹è‡‚çš„å¯¹é½æƒ…å†µï¼š

```bash
# åˆ†æå·¦è‡‚æ“ä½œ episodes (å¦‚ 0-5)
for ep in 0 1 2 3 4 5; do
    python scripts/analyze_frame_state_alignment.py \
        /path/to/agilex_clean/train \
        -e $ep \
        --gripper left \
        --camera cam_left_wrist \
        --denoise \
        -o output/agilex_left/done

# åˆ†æå³è‡‚æ“ä½œ episodes (å¦‚ 6-7)
for ep in 6 7; do
    python scripts/analyze_frame_state_alignment.py \
        /path/to/agilex_clean/train \
        -e $ep \
        --gripper right \
        --camera cam_right_wrist \
        --denoise \
        -o output/agilex_right/done
```

**ä¸ºä»€ä¹ˆä¸èƒ½åŒæ—¶åˆ†æåŒè‡‚ï¼Ÿ**
- é™æ­¢æ‰‹è‡‚çš„å¤¹çˆª state æ— å˜åŒ–ï¼Œæ— æ³•æ£€æµ‹å¯¹é½äº‹ä»¶
- å³ä½¿ä½¿ç”¨å¯¹åº”ç›¸æœºï¼Œé™æ­¢æ‰‹è‡‚çš„ç”»é¢ä¹Ÿæ— æ˜æ˜¾å˜åŒ–
- åˆ†åˆ«åˆ†ææ‰èƒ½å¾—åˆ°å‡†ç¡®çš„å¯¹é½ç»“æœ

---

## åç§»è¯„ä¼°æ ‡å‡†

| åç§»é‡ | å»¶è¿Ÿ(25fps) | å»¶è¿Ÿ(50fps) | è¯„ä¼° | å»ºè®® |
|--------|-------------|-------------|------|------|
| 0~1 å¸§ | 0-40ms | 0-20ms | âœ… ä¼˜ç§€ | å¯ç›´æ¥ä½¿ç”¨ |
| 1~2 å¸§ | 40-80ms | 20-40ms | âš ï¸ æ­£å¸¸ | é€šå¸¸å¯æ¥å— |
| > 2 å¸§ | > 80ms | > 40ms | âŒ éœ€å…³æ³¨ | å»ºè®®è¡¥å¿å¤„ç† |

> **æ³¨æ„**: æ­£åç§»è¡¨ç¤º Video æ»å Stateï¼Œè´Ÿåç§»è¡¨ç¤º Video æå‰ Stateã€‚

---

## çœŸæœº vs ä»¿çœŸï¼šåç§»å·®å¼‚åˆ†æ

### ç°è±¡è§‚å¯Ÿ

é€šè¿‡å¯¹æ¯”ä¸åŒæ¥æºçš„æ•°æ®é›†ï¼Œè§‚å¯Ÿåˆ°ä»¥ä¸‹è§„å¾‹ï¼š

| æ•°æ®ç±»å‹ | å…¸å‹åç§»æ–¹å‘ | å…¸å‹åç§»é‡ | ç¤ºä¾‹æ•°æ®é›† |
|----------|-------------|-----------|-----------|
| **çœŸæœºæ•°æ®ï¼ˆå¸¸è§„ï¼‰** | **æ­£åç§»** (Video æ»å) | +0.4 ~ +2.0 å¸§ | 0115_qz2, aloha_mobile_cabinet |
| **çœŸæœºæ•°æ®ï¼ˆç‰¹æ®Šé…ç½®ï¼‰** | **è´Ÿåç§»** (Video æå‰) | -0.5 ~ -1.0 å¸§ | franka |
| **ä»¿çœŸæ•°æ®** | **è´Ÿåç§»** (Video æå‰) | -0.5 ~ -1.4 å¸§ | agilex_sim |

> **æ³¨æ„**: Franka æ•°æ®é›†è™½ç„¶æ˜¯**çœŸæœºæ•°æ®**ï¼Œä½†å‡ºç°äº†è´Ÿåç§»ï¼ˆ-0.76å¸§ï¼‰ï¼Œè¯´æ˜å…¶é‡‡é›†ç³»ç»Ÿæœ‰ç‰¹æ®Šçš„æ—¶åºé…ç½®ã€‚

### åŸå› åˆ†æ

#### 1. çœŸæœºæ•°æ®é‡‡é›†æ—¶åº

```
æ—¶é—´è½´: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

ä¼ æ„Ÿå™¨é‡‡æ ·: [State N]      [State N+1]     [State N+2]
                 â†“               â†“              â†“
ç›¸æœºæ›å…‰:   [Exposure N]  [Exposure N+1]  [Exposure N+2]
                 â†“               â†“              â†“
æ•°æ®ä¼ è¾“:      [å»¶è¿Ÿ]          [å»¶è¿Ÿ]         [å»¶è¿Ÿ]
                 â†“               â†“              â†“
è®°å½•æ—¶é—´æˆ³:  [Image N]     [Image N+1]    [Image N+2]
                 â†“               â†“              â†“
å¯¹é½ç»“æœ:   Video æ»åäº State (æ­£åç§»)
```

**çœŸæœºæ­£åç§»åŸå› **:
- ç›¸æœº**æ›å…‰æ—¶é—´**ï¼ˆé€šå¸¸ 5-20msï¼‰
- å›¾åƒ**ä¼ è¾“å»¶è¿Ÿ**ï¼ˆUSB/ç½‘ç»œï¼‰
- ä¼ æ„Ÿå™¨ä¸ç›¸æœº**éåŒæ­¥è§¦å‘**
- è½¯ä»¶å±‚**æ—¶é—´æˆ³èµ‹å€¼**å»¶è¿Ÿ

#### 2. ä»¿çœŸæ•°æ®é‡‡é›†æ—¶åº

```
æ—¶é—´è½´: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

ç‰©ç†æ­¥è¿›:     [Step N]      [Step N+1]     [Step N+2]
                 â†“               â†“              â†“
æ¸²æŸ“å›¾åƒ:   [Render N]    [Render N+1]   [Render N+2]
                 â†“               â†“              â†“
è¯»å– State: [Read N]      [Read N+1]     [Read N+2]
                 â†“               â†“              â†“
è®°å½•æ—¶é—´æˆ³:  (Image N,      (Image N+1,    (Image N+2,
             State N)        State N+1)     State N+2)
                 â†“               â†“              â†“
å¯¹é½ç»“æœ:   Video æå‰äº State (è´Ÿåç§»)
```

**ä»¿çœŸè´Ÿåç§»åŸå› **:
- æ¸²æŸ“å‘ç”Ÿåœ¨**ç‰©ç†æ›´æ–°ä¹‹å‰**ï¼ŒImage ä½¿ç”¨ State Nï¼Œä½† State è¯»å–å»¶è¿Ÿä¸€å¸§
- æŸäº›ä»¿çœŸç¯å¢ƒä¸­**æ—¶é—´æˆ³èµ‹å€¼é¡ºåº**å¯¼è‡´ Image æ—¶é—´æˆ³æ—©äº State
- æ²¡æœ‰çœŸå®ç›¸æœºçš„**ç‰©ç†å»¶è¿Ÿ**ï¼ˆæ›å…‰ã€ä¼ è¾“ï¼‰

### æ•°æ®å¯¹æ¯”

| æ•°æ®é›† | æ¥æº | ç±»å‹ | åç§» | å¸§ç‡ | å»¶è¿Ÿ |
|--------|------|------|------|------|------|
| 0115_qz2_plant/merged | çœŸæœº (airbot_play) | å¸¸è§„ | **+0.41 å¸§** | 25 FPS | 16ms (æ»å) |
| aloha_mobile_cabinet | çœŸæœº (ALOHA) | å¸¸è§„ | **+1.55 å¸§** | 50 FPS | 31ms (æ»å) |
| franka/move_objects | çœŸæœº (Franka) | ç‰¹æ®Š* | **-0.76 å¸§** | 30 FPS | -25ms (æå‰) |
| agilex_sim/left | ä»¿çœŸ (RoboTwin) | ä»¿çœŸ | **-1.40 å¸§** | 20 FPS | -70ms (æå‰) |
| agilex_sim/right | ä»¿çœŸ (RoboTwin) | ä»¿çœŸ | **-0.50 å¸§** | 20 FPS | -25ms (æå‰) |

> \* **Franka ç‰¹æ®Šè¯´æ˜**: è™½ç„¶æ˜¯çœŸæœºæ•°æ®ï¼Œä½†å‡ºç°äº†è´Ÿåç§»ï¼Œè¯´æ˜é‡‡é›†ç³»ç»Ÿçš„æ—¶åºé…ç½®ä¸å¸¸è§„çœŸæœºä¸åŒï¼ˆå¯èƒ½æ˜¯å…ˆæ¸²æŸ“/é‡‡é›†å›¾åƒï¼Œåè¯»å–ä¼ æ„Ÿå™¨æ•°æ®ï¼‰ã€‚

### å¯¹è®­ç»ƒçš„å½±å“

#### æ˜¯å¦éœ€è¦ä¿®å¤ï¼Ÿ

| åç§»ç±»å‹ | åç§»å¤§å° | å½±å“è¯„ä¼° | å»ºè®® |
|----------|---------|---------|------|
| çœŸæœºæ­£åç§» | +0.5 ~ +2 å¸§ | è½»å¾®æ»åï¼Œé€šå¸¸å¯æ¥å— | å¯ç›´æ¥è®­ç»ƒ |
| çœŸæœºæ­£åç§» | > +2 å¸§ | æ»åæ˜æ˜¾ | è€ƒè™‘è¡¥å¿ |
| ä»¿çœŸè´Ÿåç§» | -0.5 ~ -1 å¸§ | è½»å¾®æå‰ï¼Œé€šå¸¸å¯æ¥å— | å¯ç›´æ¥è®­ç»ƒ |
| ä»¿çœŸè´Ÿåç§» | < -1.5 å¸§ | æå‰æ˜æ˜¾ | å»ºè®®è¡¥å¿ |

#### è¡¥å¿æ–¹æ³•

**æ–¹æ³• 1ï¼šæ•°æ®é¢„å¤„ç†ï¼ˆæ—¶ç§»å¯¹é½ï¼‰**
```python
# å¯¹äºä»¿çœŸè´Ÿåç§»ï¼ˆImage æå‰ï¼‰ï¼Œå°† State å‰ç§»
state_aligned = state[:-1]  # å»æ‰æœ€åä¸€å¸§
image_aligned = image[1:]   # å»æ‰ç¬¬ä¸€å¸§

# å¯¹äºçœŸæœºæ­£åç§»ï¼ˆVideo æ»åï¼‰ï¼Œå°† State åç§»
state_aligned = state[1:]   # å»æ‰ç¬¬ä¸€å¸§
image_aligned = image[:-1]  # å»æ‰æœ€åä¸€å¸§
```

**æ–¹æ³• 2ï¼šLeRobot delta_timestamps é…ç½®**
```python
# çœŸæœºæ•°æ®ï¼ˆVideo æ»å 50msï¼‰
delta_timestamps = {
    "observation.state": -0.05,  # State æå‰ 50ms
    "observation.images.cam_left": 0.0,
}

# ä»¿çœŸæ•°æ®ï¼ˆVideo æå‰ 70msï¼‰
delta_timestamps = {
    "observation.state": 0.07,   # State æ»å 70ms
    "observation.images.cam_left": 0.0,
}
```

### ç»“è®º

1. **å¸¸è§„çœŸæœºæ•°æ®**é€šå¸¸è¡¨ç°ä¸º**æ­£åç§»**ï¼ˆVideo æ»å Stateï¼‰ï¼Œä¸»è¦ç”±ç›¸æœºæ›å…‰å’Œä¼ è¾“å»¶è¿Ÿå¯¼è‡´
2. **ä»¿çœŸæ•°æ®**é€šå¸¸è¡¨ç°ä¸º**è´Ÿåç§»**ï¼ˆVideo æå‰ Stateï¼‰ï¼Œä¸»è¦ç”±æ¸²æŸ“ä¸ç‰©ç†æ›´æ–°çš„æ—¶åºå…³ç³»å¯¼è‡´
3. **ç‰¹æ®Šé…ç½®çš„çœŸæœº**ä¹Ÿå¯èƒ½å‡ºç°è´Ÿåç§»ï¼ˆå¦‚ Franka æ•°æ®é›†ï¼‰ï¼Œè¿™å–å†³äºé‡‡é›†ç³»ç»Ÿçš„æ—¶åºè®¾ç½®
4. **åç§»æ–¹å‘ä¸èƒ½å®Œå…¨ä½œä¸ºåˆ¤æ–­çœŸæœº/ä»¿çœŸçš„å”¯ä¸€æŒ‡æ ‡**ï¼Œéœ€è¦ç»“åˆæ•°æ®é›†æ¥æºä¿¡æ¯
5. **è®­ç»ƒå»ºè®®**ï¼š
   - å°åç§»ï¼ˆÂ±1 å¸§ï¼‰å¯ç›´æ¥è®­ç»ƒ
   - å¤§åç§»å»ºè®®ä½¿ç”¨ `delta_timestamps` è¿›è¡Œæ—¶é—´è¡¥å¿
   - æ··åˆè®­ç»ƒä¸åŒæ¥æºæ•°æ®æ—¶ï¼Œéœ€è¦ç»Ÿä¸€æ—¶é—´å¯¹é½æ ‡å‡†

### Franka çœŸæœºè´Ÿåç§»çš„å¯èƒ½åŸå› 

Franka ä½œä¸ºçœŸæœºå´å‡ºç°è´Ÿåç§»ï¼ˆImage æå‰ Stateï¼‰ï¼Œå¯èƒ½çš„åŸå› åŒ…æ‹¬ï¼š

1. **é‡‡é›†æ—¶åºé…ç½®**: é‡‡é›†ç¨‹åºå…ˆæ•è·å›¾åƒï¼Œåè¯»å–ä¼ æ„Ÿå™¨æ•°æ®
2. **ç¡¬ä»¶åŒæ­¥æ–¹å¼**: ç›¸æœºè§¦å‘ä¸ä¼ æ„Ÿå™¨é‡‡æ ·å­˜åœ¨ç‰¹å®šæ—¶åºå…³ç³»
3. **æ—¶é—´æˆ³èµ‹å€¼é¡ºåº**: è½¯ä»¶å±‚é¢çš„æ—¶é—´æˆ³è®°å½•é¡ºåºå¯¼è‡´
4. **æ•°æ®åå¤„ç†**: æŸäº›é¢„å¤„ç†æ­¥éª¤æ”¹å˜äº†æ—¶é—´å¯¹é½å…³ç³»

**å¯¹ç”¨æˆ·çš„å»ºè®®**: å¦‚æœçŸ¥é“ Franka æ•°æ®é›†çš„å…·ä½“é‡‡é›†æ–¹å¼ï¼Œå¯ä»¥è¿›ä¸€æ­¥éªŒè¯ä¸Šè¿°å‡è®¾ã€‚

---

## å»å™ªæ•ˆæœåˆ†æ

State å¼•å¯¼å»å™ªåœ¨æ‰€æœ‰æ•°æ®é›†ä¸Šéƒ½å–å¾—äº†æ˜¾è‘—çš„ç›¸å…³æ€§æå‡ï¼š

| æ•°æ®é›† | å»å™ªå‰ç›¸å…³æ€§ | å»å™ªåç›¸å…³æ€§ | æå‡å¹…åº¦ |
|--------|-------------|-------------|----------|
| 0115_qz2_plant/merged | 0.731 | 0.846 | +15.7% |
| 1226_qz2/merged | 0.657 | 0.874 | +33.2% |
| 1226_qz2/merged_nearest | 0.623 | 0.841 | +35.1% |
| aloha_mobile_cabinet | 0.460 | 0.617 | +34.1% |
| franka/move_objects | 0.256 | 0.466 | +82.1% |
| agilex_sim/left | 0.351 | 0.680 | +93.8% |
| agilex_sim/right | -0.053 | 0.482 | +1008.6% |

**å¹³å‡æå‡: +186.6%** (æ–°æ•°æ®é›†å™ªå£°è¾ƒå¤§ï¼Œå»å™ªæ•ˆæœæ›´æ˜¾è‘—)

---

## æ•°æ®é›†å¯¹æ¯”

### æŒ‰å¯¹é½è´¨é‡æ’åº

#### çœŸæœºæ•°æ®é›†
1. ğŸ¥‡ **0115_qz2_plant/merged** - å¯¹é½æœ€ä½³ (+0.41å¸§, 16ms)
2. ğŸ¥ˆ **aloha_mobile_cabinet** - è‰¯å¥½ (+1.55å¸§, 31ms @ 50fps)
3. ğŸ¥‰ **1226_qz2/merged** - è½»å¾®æ»å (+1.23å¸§, 49ms)
4. âš ï¸ **1226_qz2/merged_nearest** - æ»åæ˜æ˜¾ (+1.93å¸§, 77ms)

#### ä»¿çœŸæ•°æ®é›†
1. ğŸ¥‡ **agilex_sim/right** - å¯¹é½è‰¯å¥½ (-0.50å¸§, -25ms)
2. âš ï¸ **agilex_sim/left** - æå‰æ˜æ˜¾ (-1.40å¸§, -70ms)

### æ’å€¼æ–¹å¼å½±å“

å¯¹æ¯” `1226_qz2` çš„ä¸¤ç§å¤„ç†æ–¹å¼ï¼š

| å¤„ç†æ–¹å¼ | å¹³å‡åç§» | å»¶è¿Ÿ |
|----------|----------|------|
| merged (çº¿æ€§æ’å€¼) | +1.23å¸§ | 49ms |
| merged_nearest (æœ€è¿‘é‚») | +1.93å¸§ | 77ms |

**ç»“è®º**: çº¿æ€§æ’å€¼ (`merged`) çš„å¯¹é½æ•ˆæœä¼˜äºæœ€è¿‘é‚»æ’å€¼ (`merged_nearest`)ã€‚

---

## å»ºè®®

### è®­ç»ƒä½¿ç”¨å»ºè®®

#### çœŸæœºæ•°æ®é›†ï¼ˆå¸¸è§„æ­£åç§»ï¼‰
1. **0115_qz2_plant/merged**: å¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å¤„ç†
2. **aloha_mobile_cabinet**: å¯ç›´æ¥ä½¿ç”¨ï¼Œ31ms å»¶è¿Ÿåœ¨é«˜å¸§ç‡ä¸‹å½±å“è¾ƒå°
3. **1226_qz2/merged**: å»ºè®®ä½¿ç”¨ï¼Œå¦‚è¿½æ±‚æè‡´å¯è€ƒè™‘ State åç§» 1 å¸§
4. **1226_qz2/merged_nearest**: å»ºè®®å°† State/Action åç§» 2 å¸§ä¸ Video å¯¹é½

#### çœŸæœºæ•°æ®é›†ï¼ˆç‰¹æ®Šè´Ÿåç§»ï¼‰
5. **franka/move_objects**: è½»å¾®æå‰ï¼ˆ-25msï¼‰ï¼Œå¯ç›´æ¥ä½¿ç”¨æˆ–è€ƒè™‘ State åç§» 1 å¸§è¡¥å¿

#### ä»¿çœŸæ•°æ®é›†
6. **agilex_sim/left**: æå‰è¾ƒæ˜æ˜¾ (-70ms)ï¼Œå»ºè®®è®­ç»ƒæ—¶ä½¿ç”¨ `delta_timestamps` è¡¥å¿
7. **agilex_sim/right**: è½»å¾®æå‰ï¼Œå¯ç›´æ¥ä½¿ç”¨

#### å•è‡‚äº¤æ›¿æ“ä½œæ•°æ®é›†ç‰¹æ®Šè¯´æ˜
å¯¹äº **adjust_bottle/agilex_clean** è¿™ç±»å•è‡‚äº¤æ›¿æ“ä½œæ•°æ®é›†ï¼š
- è®­ç»ƒæ—¶æ— éœ€ç‰¹æ®Šå¤„ç†ï¼ŒæŒ‰æ­£å¸¸åŒè‡‚æ•°æ®è®­ç»ƒå³å¯
- æ¨¡å‹ä¼šè‡ªåŠ¨å­¦ä¹ åˆ°"åªç”¨ä¸€åªæ‰‹è‡‚"çš„ç­–ç•¥
- å¦‚éœ€åˆ†åˆ«è¯„ä¼°å·¦å³è‡‚æ€§èƒ½ï¼Œå¯æŒ‰ episode åˆ†ç¦»æ•°æ®ååˆ†åˆ«æµ‹è¯•

### æ•°æ®å¤„ç†å»ºè®®

- ä¼˜å…ˆä½¿ç”¨**çº¿æ€§æ’å€¼**è€Œéæœ€è¿‘é‚»æ’å€¼è¿›è¡Œæ•°æ®å¯¹é½
- å¯¹äº > 2 å¸§åç§»çš„æ•°æ®é›†ï¼Œå¯åœ¨åŠ è½½æ—¶è¿›è¡Œæ—¶é—´è¡¥å¿
- ä½¿ç”¨ `--denoise` é€‰é¡¹å¯æ˜¾è‘—æé«˜åç§»æ£€æµ‹çš„å‡†ç¡®æ€§

### å¦‚ä½•åˆ¤æ–­æ•°æ®é›†æ˜¯å•è‡‚è¿˜æ˜¯åŒè‡‚æ“ä½œï¼Ÿ

åœ¨åˆ†æå¯¹é½ä¹‹å‰ï¼Œå»ºè®®å…ˆæ£€æŸ¥æ•°æ®é›†çš„å¤¹çˆªåŠ¨ä½œæ¨¡å¼ï¼š

```python
import pandas as pd
import numpy as np
from pathlib import Path

def check_gripper_activity(data_dir, threshold=0.01):
    '''æ£€æŸ¥æ•°æ®é›†ä¸­åŒè‡‚çš„åŠ¨ä½œæƒ…å†µ'''
    files = sorted(Path(data_dir).glob('episode_*.parquet'))
    
    left_active = 0
    right_active = 0
    both_active = 0
    
    for f in files[:20]:  # æ£€æŸ¥å‰ 20 ä¸ª episodes
        df = pd.read_parquet(f)
        state = np.stack(df['observation.state'].values)
        
        left_diff = np.abs(np.diff(state[:, 6])).max()   # å·¦å¤¹çˆª
        right_diff = np.abs(np.diff(state[:, 13])).max() # å³å¤¹çˆª
        
        if left_diff > threshold and right_diff > threshold:
            both_active += 1
        elif left_diff > threshold:
            left_active += 1
        elif right_diff > threshold:
            right_active += 1
    
    if both_active > 10:
        return f"åŒè‡‚æ“ä½œæ•°æ®é›† (åŒè‡‚åŒæ—¶åŠ¨ä½œ: {both_active}/20)"
    elif left_active > 0 and right_active > 0:
        return f"å•è‡‚äº¤æ›¿æ“ä½œæ•°æ®é›† (å·¦è‡‚: {left_active}, å³è‡‚: {right_active})"
    elif left_active > 0:
        return f"çº¯å·¦è‡‚æ“ä½œæ•°æ®é›† (å·¦è‡‚: {left_active}/20)"
    else:
        return f"çº¯å³è‡‚æ“ä½œæ•°æ®é›† (å³è‡‚: {right_active}/20)"

# ä½¿ç”¨ç¤ºä¾‹
result = check_gripper_activity('/path/to/dataset/data/chunk-000')
print(result)
```

**åˆ¤æ–­æ ‡å‡†**:
- **åŒè‡‚æ“ä½œ**: å¤§å¤šæ•° episodes ä¸­åŒè‡‚åŒæ—¶æœ‰åŠ¨ä½œ
- **å•è‡‚äº¤æ›¿**: ä¸åŒ episodes åˆ†åˆ«ä½¿ç”¨å·¦è‡‚æˆ–å³è‡‚
- **çº¯å•è‡‚**: æ‰€æœ‰ episodes åªä½¿ç”¨ä¸€åªæ‰‹è‡‚

---

## ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| [`scripts/analyze_frame_state_alignment.py`](../scripts/analyze_frame_state_alignment.py) | åˆ†æè„šæœ¬ |
| [`docs/frame_state_alignment.md`](frame_state_alignment.md) | åŸç†è¯´æ˜æ–‡æ¡£ |
| `output/analysis_*/episode_*_alignment.png` | å¯è§†åŒ–å›¾è¡¨ |
| `output/analysis_*/episode_*_report.json` | è¯¦ç»† JSON æŠ¥å‘Š |
