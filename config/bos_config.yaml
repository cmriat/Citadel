# BOS (百度云对象存储) 集成配置

bos:
  # 连接配置
  endpoint: "https://s3.bj.bcebos.com"
  bucket: "srgdata"
  # 凭证从环境变量读取（安全性）
  # 运行前设置: export BOS_ACCESS_KEY=xxx BOS_SECRET_KEY=xxx
  access_key: "${BOS_ACCESS_KEY}"
  secret_key: "${BOS_SECRET_KEY}"
  region: "bj"  # 北京区域

  # 路径配置
  paths:
    raw_data: "robot/raw_data/upload_test/online_test/quad_arm_task/"  # 原始数据前缀
    converted: "robot/raw_data/upload_test/converted/"                  # 转换后数据输出前缀

  # 任务名称（用于目录重组织）
  task_name: "quad_arm_task"  # 本地格式需要的任务名称子目录

  # 扫描配置
  scanner:
    interval: 120                       # 扫描间隔（秒），默认 2 分钟
    timeout: 300                        # 单次扫描超时（秒）
    max_keys: 1000                      # 每次 List 最多获取的对象数
    enable_incremental: true            # 启用增量扫描（记录上次扫描位置）
    incremental_key: "bos:last_scanned_key"  # Redis key for storing scan position

  # 数据完整性检查
  validation:
    # 必须存在的子目录
    required_dirs:
      - "images"
      - "joints"

    # 检查文件数量是否匹配
    check_count_match: false            # 暂时关闭，因为新格式 images 和 joints 数量不同
    count_tolerance: 0                  # 允许的文件数量差异（0 表示必须完全一致）

    # 上传稳定性检查（防止扫描到正在上传中的数据）
    stable_time: 10                     # 最后修改后等待时间（秒），测试用，生产环境建议 180

    # 最少文件数量要求
    min_file_count: 1                   # 每个目录至少要有 1 个文件

  # 下载配置
  download:
    temp_dir: "${LEROBOT_TEMP_DIR}"     # 临时下载目录（支持环境变量，默认使用系统temp）
    concurrent: 4                       # 并发下载线程数
    chunk_size: 8388608                 # 下载块大小（8MB）
    retry: 3                            # 下载失败重试次数
    retry_delay: 5                      # 重试延迟（秒）

  # 上传配置
  upload:
    concurrent: 4                       # 并发上传线程数
    chunk_size: 8388608                 # 上传块大小（8MB）
    retry: 3                            # 上传失败重试次数
    retry_delay: 5                      # 重试延迟（秒）
    cleanup_local: true                 # 上传成功后删除本地临时文件
    overwrite: false                    # 是否覆盖已存在的文件

# Redis 配置（复用现有配置或覆盖）
redis:
  host: "localhost"
  port: 6379
  password: null
  db: 0
  queue_name: "lerobot:episodes"       # Redis 队列名称
  stream_name: "episodes:new"           # Redis Stream 名称（暂未使用）
  consumer_group: "converters"          # 消费者组名称

# 转换配置（复用现有配置）
conversion:
  strategy: "chunking"                  # 默认对齐策略
  output_fps: 30                        # 输出视频帧率
  chunk_size: 10                        # Action chunking 大小

# 日志配置
logging:
  level: "INFO"                         # DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: null                            # 日志文件路径（null 表示只输出到控制台）
